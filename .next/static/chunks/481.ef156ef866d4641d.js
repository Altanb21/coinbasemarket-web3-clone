(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481,707,511],{68531:function(e,r,t){"use strict";t.d(r,{Z:function(){return h}});var n=t(4942),i=t(22782),a=t(16843),s=t(79826),o=t(23420),c=t.n(o);function d(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?d(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class h extends i.xG{constructor(e){let{config:r,state:t}=e;if(super({config:r,state:t}),(0,n.Z)(this,"_providerEngineProxy",null),!r.chainConfig)throw a.Ty.invalidProviderConfigError("Please provide chainConfig");if(!r.chainConfig.chainId)throw a.Ty.invalidProviderConfigError("Please provide chainId inside chainConfig");if(!r.chainConfig.rpcTarget)throw a.Ty.invalidProviderConfigError("Please provide rpcTarget inside chainConfig");this.defaultState={chainId:"loading"},this.defaultConfig={chainConfig:r.chainConfig,networks:{[r.chainConfig.chainId]:r.chainConfig}},super.initialize()}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){if(!e.chainId)throw s.ethErrors.rpc.invalidParams("chainId is required");if(!e.rpcTarget)throw s.ethErrors.rpc.invalidParams("chainId is required");this.configure({networks:u(u({},this.config.networks),{},{[e.chainId]:e})})}getChainConfig(e){var r;const t=null===(r=this.config.networks)||void 0===r?void 0:r[e];if(!t)throw s.ethErrors.rpc.invalidRequest("Chain ".concat(e," is not supported, please add chainConfig for it"));return t}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=(0,i.qY)(e)}}c()()},54877:function(e,r,t){"use strict";t.r(r),t.d(r,{PhantomInjectedProvider:function(){return E},SolanaPrivateKeyProvider:function(){return T},SolanaWallet:function(){return x},TorusInjectedProvider:function(){return A}});var n=t(4942),i=t(22782),a=t(95844),s=t(16843),o=t(68531),c=t(59917),d=t(77191),u=t.n(d),h=t(79826),p=t(50108),g=t.n(p),l=t(48764).Buffer;function f(e){let{getAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:i}=e;if("getAccounts"!==i)return n();if(!r)throw new Error("WalletMiddleware - opts.getAccounts not provided");const a=await r(e);t.result=a}))}function m(e){let{requestAccounts:r}=e;return(0,a.Pk)((async(e,t,n)=>{const{method:i}=e;if("requestAccounts"!==i)return n();if(!r)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const a=await r(e);t.result=a}))}function v(e,r){return(0,a.Pk)((async(t,n,i)=>{const{method:a}=t;if(a!==e)return i();if(!r)throw new Error("WalletMiddleware - ".concat(e," not provided"));const s=await r(t);n.result=s}))}function y(e){const{getAccounts:r,requestAccounts:t,signTransaction:n,signAndSendTransaction:i,signAllTransactions:s,signMessage:o,getPrivateKey:c}=e;return(0,a.UZ)([m({requestAccounts:t}),f({getAccounts:r}),v("signTransaction",n),v("signAndSendTransaction",i),v("signAllTransactions",s),v("signMessage",o),v("solanaPrivateKey",c)])}function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e){return(0,a.Pk)((async(r,t,i)=>{const a=await e.request(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},r));t.result=a}))}function O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function b(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class E extends o.Z{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:b(b({},r.chainConfig),{},{chainNamespace:s.EN.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){const r=(e=>({requestAccounts:async()=>e.publicKey?[u().encode(e.publicKey.toBytes())]:[],getAccounts:async()=>e.publicKey?[u().encode(e.publicKey.toBytes())]:[],getPrivateKey:async()=>{throw h.ethErrors.rpc.methodNotSupported()},signTransaction:async r=>{const t=u().decode(r.params.message),n=c.YW.from(t);return await e.signTransaction(n)},signMessage:async r=>{var t;return await e.request({method:"signMessage",params:{message:null===(t=r.params)||void 0===t?void 0:t.message}})},signAndSendTransaction:async r=>{const t=u().decode(r.params.message),n=c.YW.from(t);return{signature:(await e.signAndSendTransaction(n)).signature}},signAllTransactions:async r=>{var t,n;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw h.ethErrors.rpc.invalidParams("message");const i=r.params.message.map((e=>{const r=u().decode(e);return c.YW.from(r)}));return await e.signAllTransactions(i)}}))(e),t=y(r),n=P(e),s=new a.eI;s.push(t),s.push(n);const o=(0,i.Xj)(s);this.updateProviderEngineProxy(o),await this.lookupNetwork(e)}async lookupNetwork(e){const{chainConfig:r}=this.config;return this.update({chainId:r.chainId}),r.chainId||""}}function C(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function j(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?C(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class A extends o.Z{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:j(j({},r.chainConfig),{},{chainNamespace:s.EN.SOLANA})},state:t})}async switchChain(e){return Promise.resolve()}async setupProvider(e){this.handleInjectedProviderUpdate(e),await this.setupEngine(e)}async lookupNetwork(){if(!this.provider)throw h.ethErrors.provider.custom({message:"Torus solana provider is not initialized",code:4902});const{chainId:e}=this.config.chainConfig,r=await this.provider.request({method:"solana_chainId"}),t=(0,s.H2)(r.toString())?r:"0x".concat(parseInt(r,10).toString(16));if(e!==t)throw s.Ty.rpcConnectionError("Invalid network, net_version is: ".concat(t,", expected: ").concat(e));return this.update({chainId:t}),this.provider.emit("connect",{chainId:this.state.chainId}),this.provider.emit("chainChanged",this.state.chainId),this.state.chainId}async setupEngine(e){const r=(e=>({requestAccounts:async()=>await e.request({method:"solana_requestAccounts",params:{}}),getAccounts:async()=>await e.request({method:"solana_accounts",params:{}}),getPrivateKey:async()=>{throw h.ethErrors.rpc.methodNotSupported()},signMessage:async r=>{var t;return await e.request({method:"sign_message",params:{data:null===(t=r.params)||void 0===t?void 0:t.message}})},signTransaction:async r=>{var t;if(null===(t=r.params)||void 0===t||!t.message)throw h.ethErrors.rpc.invalidParams("message");const n=u().decode(r.params.message).toString("hex"),i=await e.request({method:"sign_transaction",params:{message:n}}),a=l.from(i,"hex");return c.YW.from(a)},signAndSendTransaction:async r=>{var t;if(null===(t=r.params)||void 0===t||!t.message)throw h.ethErrors.rpc.invalidParams("message");const n=u().decode(r.params.message).toString("hex");return{signature:await e.request({method:"send_transaction",params:{message:n}})}},signAllTransactions:async r=>{var t,n;if(null===(t=r.params)||void 0===t||!t.message||null===(n=r.params)||void 0===n||!n.message.length)throw h.ethErrors.rpc.invalidParams("message");const i=[];for(const e of r.params.message){const r=u().decode(e).toString("hex");i.push(r)}return await e.request({method:"sign_all_transactions",params:{message:i}})}}))(e),t=y(r),n=P(e),s=new a.eI;s.push(t),s.push(n);const o=(0,i.Xj)(s);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async handleInjectedProviderUpdate(e){e.on("accountsChanged",(async e=>{this.provider.emit("accountsChanged",e)})),e.on("chainChanged",(async r=>{const t=(0,s.H2)(r)?r:"0x".concat(parseInt(r,10).toString(16));this.configure({chainConfig:j(j({},this.config.chainConfig),{},{chainId:t})}),await this.setupProvider(e)}))}}function I(e){return(r,t,n,i)=>"solana_chainId"===r.method?(t.result=e,i()):n()}function S(e){return(r,t,n,i)=>"solana_provider_config"===r.method?(t.result=e,i()):n()}function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function k(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}class T extends o.Z{constructor(e){let{config:r,state:t}=e;super({config:{chainConfig:k(k({},r.chainConfig),{},{chainNamespace:s.EN.SOLANA})},state:t})}async enable(){if(!this.state.privateKey)throw h.ethErrors.provider.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(e){const r=await async function(e){let{privKey:r,getProviderEngineProxy:t}=e;const n=e=>{const r=u().decode(e);return c.YW.from(r)};if("string"!==typeof r)throw s.Ty.invalidParams("privKey must be a string");const i=c.RG.fromSecretKey(l.from(r,"hex"));return{requestAccounts:async()=>[i.publicKey.toBase58()],getAccounts:async()=>[i.publicKey.toBase58()],getPrivateKey:async()=>r,signTransaction:async e=>{var r,t;if(null===(r=e.params)||void 0===r||!r.message)throw h.ethErrors.rpc.invalidParams("message");const a=n(null===(t=e.params)||void 0===t?void 0:t.message);return a.partialSign(i),a},signMessage:async e=>{var r;if(null===(r=e.params)||void 0===r||!r.message)throw h.ethErrors.rpc.invalidParams("message");return g().sign.detached(e.params.message,i.secretKey)},signAndSendTransaction:async e=>{var r,a;if(null===(r=e.params)||void 0===r||!r.message)throw h.ethErrors.rpc.invalidParams("message");const s=t();if(!s)throw h.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const o=n(null===(a=e.params)||void 0===a?void 0:a.message);return o.sign(i),{signature:await s.request({method:"sendTransaction",params:[u().encode(o.serialize())]})}},signAllTransactions:async e=>{var r,t;if(null===(r=e.params)||void 0===r||!r.message||null===(t=e.params)||void 0===t||!t.message.length)throw h.ethErrors.rpc.invalidParams("message");const a=[];for(const o of(null===(s=e.params)||void 0===s?void 0:s.message)||[]){var s;const e=n(o);e.partialSign(i),a.push(e)}return a}}}({privKey:e,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)}),t=y(r),n=new a.eI,{networkMiddleware:o}=function(e){const{chainId:r,rpcTarget:t}=e,n=(0,i.v$)({rpcTarget:t});return{networkMiddleware:(0,a.UZ)([I(r),S(e),n]),fetchMiddleware:n}}(this.config.chainConfig);n.push(this.getChainSwitchMiddleware()),n.push(this.getAccountMiddleware()),n.push(t),n.push(o);const d=(0,i.Xj)(n);this.updateProviderEngineProxy(d),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw h.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this._providerEngineProxy.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw h.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const r=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:r});const t=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(t)}async lookupNetwork(){if(!this._providerEngineProxy)throw h.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:r}=this.config;if("ok"!==e)throw s.Ty.rpcConnectionError("Failed to lookup network for following rpc target: ".concat(r.rpcTarget));return this.update({chainId:r.chainId}),this.state.chainId!==r.chainId&&(this.provider.emit("chainChanged",this.state.chainId),this.provider.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return function(e){let{addNewChainConfig:r,switchSolanaChain:t}=e;return(0,a.UZ)([v("addSolanaChain",r),v("switchSolanaChain",t)])}({addNewChainConfig:async e=>{if(!e.params)throw h.ethErrors.rpc.invalidParams("Missing request params");const{chainId:r,chainName:t,rpcUrls:n,blockExplorerUrls:i,nativeCurrency:a}=e.params;if(!r)throw h.ethErrors.rpc.invalidParams("Missing chainId in chainParams");if(!n||0===n.length)throw h.ethErrors.rpc.invalidParams("Missing rpcUrls in chainParams");if(!a)throw h.ethErrors.rpc.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:s.EN.SOLANA,chainId:r,ticker:(null===a||void 0===a?void 0:a.symbol)||"SOL",tickerName:(null===a||void 0===a?void 0:a.name)||"Solana",displayName:t,rpcTarget:n[0],blockExplorer:(null===i||void 0===i?void 0:i[0])||""})},switchSolanaChain:async e=>{if(!e.params)throw h.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.chainId)throw h.ethErrors.rpc.invalidParams("Missing chainId");await this.switchChain(e.params)}})}getAccountMiddleware(){return function(e){let{updatePrivatekey:r}=e;return(0,a.UZ)([v("updateAccount",r)])}({updatePrivatekey:async e=>{if(!e.params)throw h.ethErrors.rpc.invalidParams("Missing request params");if(!e.params.privateKey)throw h.ethErrors.rpc.invalidParams("Missing privateKey");const{privateKey:r}=e.params;await this.updateAccount({privateKey:r})}})}}(0,n.Z)(T,"getProviderInstance",(async e=>{const r=new T({config:{chainConfig:e.chainConfig}});return await r.setupProvider(e.privKey),r}));class x{constructor(e){(0,n.Z)(this,"provider",void 0),this.provider=e}async requestAccounts(){return await this.provider.request({method:"requestAccounts",params:{}})}async signAndSendTransaction(e){const{signature:r}=await this.provider.request({method:"signAndSendTransaction",params:{message:u().encode(e.serialize({requireAllSignatures:!1}))}});return{signature:r}}async signTransaction(e){return await this.provider.request({method:"signTransaction",params:{message:u().encode(e.serialize({requireAllSignatures:!1}))}})}async signAllTransactions(e){const r=e.map((e=>u().encode(e.serialize({requireAllSignatures:!1}))));return await this.provider.request({method:"signAllTransactions",params:{message:r}})}async signMessage(e){return await this.provider.request({method:"signMessage",params:{message:e}})}async request(e){return await this.provider.request(e)}}},11922:function(){},22399:function(){},78848:function(){},71456:function(){}}]);